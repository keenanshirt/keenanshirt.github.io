<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Samsung TV Signage – Google Slides</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      overflow: hidden;            /* no scrollbars */
      cursor: none;                /* always hide cursor */
      -webkit-user-select: none;   
      -moz-user-select: none;
      user-select: none;
      touch-action: manipulation;  /* reduce touch delays */
    }
    iframe#deck {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      border: 0;
      cursor: none;                /* hide over iframe area too */
      background: #000;
    }
    /* Hide scrollbars in WebKit/Blink */
    ::-webkit-scrollbar { display: none; }
  </style>
</head>
<body>
  <iframe
    id="deck"
    src="https://docs.google.com/presentation/d/e/2PACX-1vTcvwa1irS_Vah7LsHWKBwzs4oiJImAAuqIa2ZOX7STMw-Ktd7vF--YyTVvxdcsyPpvqY697Pm_CYMA/pubembed?start=true&loop=true&delayms=5000&rm=minimal"
    allow="autoplay; fullscreen"
    allowfullscreen
    mozallowfullscreen
    webkitallowfullscreen
    referrerpolicy="no-referrer"
  ></iframe>

  <script>
    // Samsung TV–friendly digital signage (no overlays/prompts)
    // Assumptions: TV powers OFF at 00:00 and ON at 08:00 daily.

    const CONFIG = {
      // Reload shortly after morning power-on to ensure a fresh session
      morningReload: { hour: 8, minute: 5 },
      // Optional mid‑day reloads to keep memory fresh (set to null to disable)
      middayReload:   { hour: 14, minute: 0 },
      eveningReload:  { hour: 20, minute: 0 },
      // One-time warm-up reload after boot (ms). Helps if the first load races the network.
      bootWarmupReloadMs: 45000,
      // Lightweight connectivity probe; success implies network is up
      pingUrl: 'https://www.gstatic.com/generate_204',
      pingIntervalMs: 60000,            // check every 60s
      offlineReloadDelayMs: 15000,      // wait 15s then retry when offline
      useWakeLock: false                // TVs manage their own power; no wake lock
    };

    const deck = document.getElementById('deck');

    // Keep cursor hidden even after interactions (some remotes emulate a mouse)
    const rehideCursor = () => {
      document.documentElement.style.cursor = 'none';
      document.body.style.cursor = 'none';
    };
    ['mousemove','mousedown','keydown','touchstart'].forEach(evt =>
      window.addEventListener(evt, rehideCursor, { passive: true })
    );

    // Block context menu & accidental navigation keys
    window.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', (e) => {
      const blocked = [8, 33, 34, 35, 36, 37, 38, 39, 40]; // backspace, pgup/down, home/end, arrows
      if (blocked.includes(e.keyCode)) e.preventDefault();
      // Tizen back key (often 10009) – prevent navigating away
      if (e.keyCode === 10009) e.preventDefault();
    });

    // --- Reload helpers ---
    function reloadDeck() {
      try {
        const u = new URL(deck.src);
        u.searchParams.set('_ts', Date.now().toString());
        deck.src = u.toString();
      } catch {
        deck.src = deck.src; // fallback hard reload
      }
    }

    function scheduleReloadAt(hour, minute) {
      if (hour == null || minute == null) return;
      const now = new Date();
      const next = new Date(now);
      next.setHours(hour, minute, 0, 0);
      if (next <= now) next.setDate(next.getDate() + 1);
      setTimeout(() => { reloadDeck(); scheduleReloadAt(hour, minute); }, next - now);
    }

    // Schedule reloader windows based on the TV's on-hours (08:00–24:00)
    scheduleReloadAt(CONFIG.morningReload?.hour, CONFIG.morningReload?.minute);
    scheduleReloadAt(CONFIG.middayReload?.hour,   CONFIG.middayReload?.minute);
    scheduleReloadAt(CONFIG.eveningReload?.hour,  CONFIG.eveningReload?.minute);

    // Warm-up reload to stabilize after cold boot
    if (CONFIG.bootWarmupReloadMs) {
      setTimeout(reloadDeck, CONFIG.bootWarmupReloadMs);
    }

    // --- Connectivity watchdog (quiet) ---
    async function pingOnce() {
      if (!navigator.onLine) return false;
      try {
        // no-cors yields an opaque response; success means we reached the server
        await fetch(CONFIG.pingUrl, { mode: 'no-cors', cache: 'no-store' });
        return true;
      } catch (_) { return false; }
    }

    async function connectivityLoop() {
      const ok = await pingOnce();
      if (!ok) {
        // If offline, try again later; when it comes back, force a refresh
        setTimeout(async () => {
          const back = await pingOnce();
          if (back) reloadDeck();
        }, CONFIG.offlineReloadDelayMs);
      }
      setTimeout(connectivityLoop, CONFIG.pingIntervalMs);
    }
    connectivityLoop();

    // Quiet console (avoid debug overlays on some TVs)
    console.log = console.warn = console.error = function(){};
  </script>
</body>
</html>
